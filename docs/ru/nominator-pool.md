# Номинаторский пул

## Запуск валидатора в режиме номинаторского пула

1. Подготовьте аппаратное обеспечение для валидатора - 8 виртуальных ядер, 64GB памяти, 1TB SSD, фиксированный IP-адрес, скорость интернета 1Gb/s.

   Для поддержания стабильности сети рекомендуется разместить валидаторы в различных местах по всему миру, а не концентрировать их в одном дата-центре. Вы можете использовать [этот сайт](https://status.toncenter.com/) для определения нагрузки на различные места. Согласно карте, высокая нагрузка на дата-центры в Европе, особенно в Финляндии, Германии и Париже. Поэтому использование провайдеров, таких как Hetzner и OVH, не рекомендуется.

   > Ваше оборудование должно соответствовать указанной конфигурации или быть выше. Запуск валидатора на слабом оборудовании негативно влияет на сеть и может привести к штрафам.

   > С мая 2021 года Hetzner запретил майнинг на своих серверах, в настоящее время под это правило попадают алгоритмы PoW и PoS. Установка даже обычного узла будет считаться нарушением условий договора.

   > **Рекомендуемые провайдеры:** [Amazon](https://aws.amazon.com/), [DigitalOcean](https://www.digitalocean.com/), [Linode](https://www.linode.com/), [Alibaba Cloud](https://alibabacloud.com/), [Latitude](https://www.latitude.sh/).

2. Установите и синхронизируйте **mytonctrl** в соответствии с описанием в [этой инструкции](https://github.com/ton-blockchain/mytonctrl/blob/master/docs/ru/manual-ubuntu.md) — следуйте **только** пунктам 1, 2 и 3.

   Вы также можете обратиться к этой [Видеоинструкции](https://ton.org/docs/#/nodes/run-node) для дополнительной помощи.

3. Переведите 1 TON на адрес кошелька валидатора, который отображается в списке `wl`.

4. Используйте команду `aw` для активации кошелька валидатора.

5. Создайте два пула (для четного и нечетного раунда проверки):
   
   ```
   new_pool p1 0 1 1000 300000
   new_pool p2 0 1 1001 300000
   ```
   
   где
    * `p1` — имя пула;
    * `0` % — это доля вознаграждения валидатора (например, используйте 40 для 40%);
    * `1` - максимальное количество номинаторов в пуле (должно быть <= 40);
    * `1000` TON — минимальная ставка валидатора (должна быть >= 1K TON);
    * `300000` TON – минимальная ставка номинатора (должна быть >= 10K TON);

   > (!) Конфигурации пулов не должны быть идентичными, вы можете добавить 1 к минимальной ставке одного пула, чтобы сделать их разными.

   > (!) Используйте https://tonmon.xyz/, чтобы определить текущую минимальную ставку валидатора.

6. Введите `pools_list` чтобы отобразить адреса пулов:

   ```
   pools_list
   Name  Status  Balance  Address
   p1    empty   0        0f98YhXA9wnr0d5XRXT-I2yH54nyQzn0tuAYC4FunT780qIT
   p2    empty   0        0f9qtmnzs2-PumMisKDmv6KNjNfOMDQG70mQdp-BcAhnV5jL
   ```

7. Отправьте по 1 TON в каждый пул и активируйте пулы:
   
   ```
   mg validator_wallet_001 0f98YhXA9wnr0d5XRXT-I2yH54nyQzn0tuAYC4FunT780qIT 1
   mg validator_wallet_001 0f9qtmnzs2-PumMisKDmv6KNjNfOMDQG70mQdp-BcAhnV5jL 1
   activate_pool p1
   activate_pool p2
   ```

8. Введите `pools_list` чтобы отобразить адреса пулов:
   
   ```
   pools_list
   Name  Status  Balance      Address
   p1    active  0.731199733  kf98YhXA9wnr0d5XRXT-I2yH54nyQzn0tuAYC4FunT780v_W
   p2    active  0.731199806  kf9qtmnzs2-PumMisKDmv6KNjNfOMDQG70mQdp-BcAhnV8UO
   ```

9. Откройте каждый пул по ссылке "https://tonscan.org/nominator/<address_of_pool>" и проверьте конфигурацию пулов.

10. Совершите депозит валидатора в каждый пул:

    ```bash
    deposit_to_pool validator_wallet_001 <address_of_pool_1> 1005
    deposit_to_pool validator_wallet_001 <address_of_pool_2> 1005
    ```

    где `1005` TON - это сумма депозита. Обратите внимание, что пул вычтет 1 TON за обработку депозита.

11. Совершите депозит номинатора в каждый пул:

    Перейдите по ссылке пула (из **шага 9**) и нажмите **ADD STAKE**. 
    Вы также можете сделать депозит, используя **mytonctrl**, с помощью следующих команд:

    ```bash
    mg nominator_wallet_001 <address_of_pool_1> 300001 -C d
    mg nominator_wallet_001 <address_of_pool_2> 300001 -C d
    ```

    > (!) Кошелек номинатора должен быть инициализирован в basechain (workchain 0).

    > (!) Обратите внимание, что кошельки валидатора и номинатора должны храниться отдельно! Кошелек валидатора должен храниться на сервере с узлом валидатора для обработки всех системных транзакций. Кошелек номинатора следует хранить в вашем холодном криптовалютном кошельке.

    > Чтобы снять депозит номинатора, отправьте транзакцию с комментарием `w` на адрес пула (должен быть прикреплен 1 TON для обработки транзакции). Вы также можете сделать это с помощью **mytonctrl**.

12. Активируйте режим пула:

    ```bash
    set usePool true
    set stake null
    ```

13. Пригласите номинаторов сделать депозиты в ваши пулы. Участие в валидации начнется автоматически.

    > (!) Убедитесь, что у вас на кошельке валидатора есть как минимум 200 TON в месяц на операционные расходы.

## Настройка пулов

Если вы хотите давать в долг самому себе, то используйте `new_pool p1 0 1 1000 300000` (максимум 1 номинант, 0% доли валидатора).

Если вы создаете пул для многих номинантов, то используйте что-то вроде этого: `new_pool p1 40 40 10000 10000` (максимум 40 номинантов, 40% доли валидатора, минимальная ставка участника 10K TON).

## Переключение обычного валидатора в режим номинантского пула

1. Введите `set stake 0`, чтобы отключить участие в выборах.

2. Дождитесь, когда оба ваших депозита вернутся от электора.

3. Следуйте инструкциям "Запуск валидатора в режиме номинантского пула", начиная с **4-го шага**.